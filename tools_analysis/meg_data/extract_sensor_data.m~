% AW 5/8/20

% extract preprocessed sensor data into cosmo friendly format
root    = '/group/woolgar-lab/projects/Dorian/EvAccum/';
%root	= '/imaging/at07/Matlab/Projects/Dorian/evaccum2';
droot   = fullfile(root, 'data/meg_pilot_1/megdata/');
infld   = fullfile(droot, '%s/MEEG/MaxfilterOutput/');
tarfld  = fullfile(droot, '%s/MEEG/Preprocess/');
behav   = fullfile(root,'data/meg_pilot_1/behavioural/%s/%s_EvAccum.mat');%at
megrt   = fullfile(root,'data/meg_pilot_1/behavioural/%s/subj_%s_MEGRTs.mat');%at
ICA     = fullfile(droot, '%s/MEEG/ICAOutput/ICA%s.mat');
outpt   = fullfile(droot, '%s/MEEG/Preprocess/MSL_%s.mat');

addpath(genpath('/imaging/local/software/spm_cbu_svn/releases/spm12_fil_r7487')); %spm
addpath('/group/woolgar-lab/projects/Dorian/EvAccum/tools_analysis/meg_data'); %where Ale's extract_chans function lives
%filename = '/imaging/at07/Matlab/Projects/Dorian/evaccum2/data/meg_pilot_1/megdata/subj_3/MEEG/Preprocess/SL_subj_3.mat';
%filename='/imaging/aw02/tempEA/SL_subj_3.mat';
filename='/group/woolgar-lab/projects/Dorian/EvAccum/data/meg_pilot_1/megdata/subj_3/MEEG/Preprocess/SL_subj_3.mat';
[EEG,MEGMAG,MEGPLANAR,conditions,chanlabels,badchans, trialinfo] = extract_chans_withtrialnums(filename);

load(behavfile,'MEG_RT');

% Yields channel * timepoints * trials matrices

% next: reshape into cosmo format: 
% ds.samples = trials * timepoints
% ds.sa.targets = list of conditions (numeric)
% will also need chunks - any restrictions on what to hold out?
% ds.sa.rep can all be ones (is the repetitions of each condition per
% chunk)

% NB are we doing decoding next, or RSA?? :)
